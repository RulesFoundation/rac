{
  "state": {
    "iteration": 2,
    "total_provisions_attempted": 6,
    "total_successes": 6,
    "success_rate": 1.0,
    "n_examples": 6,
    "n_failure_patterns": 7,
    "iteration_history": [
      {
        "iteration": 1,
        "provisions": {
          "eitc_phase_in": {
            "success": true,
            "accuracy": 1.0,
            "iterations": 1,
            "cost_usd": 0.15432
          },
          "standard_deduction": {
            "success": true,
            "accuracy": 1.0,
            "iterations": 2,
            "cost_usd": 0.213465
          },
          "salt_cap": {
            "success": true,
            "accuracy": 1.0,
            "iterations": 5,
            "cost_usd": 0.37866
          }
        },
        "successes": 3,
        "total": 3,
        "success_rate": 1.0
      },
      {
        "iteration": 2,
        "provisions": {
          "eitc_phase_in": {
            "success": true,
            "accuracy": 1.0,
            "iterations": 1,
            "cost_usd": 0.20721
          },
          "standard_deduction": {
            "success": true,
            "accuracy": 1.0,
            "iterations": 1,
            "cost_usd": 0.183885
          },
          "salt_cap": {
            "success": true,
            "accuracy": 1.0,
            "iterations": 1,
            "cost_usd": 0.185955
          }
        },
        "successes": 3,
        "total": 3,
        "success_rate": 1.0
      }
    ],
    "total_input_tokens": 56063,
    "total_output_tokens": 6434,
    "total_cost_usd": 1.323495
  },
  "examples": [
    {
      "provision": "eitc_phase_in",
      "citation": "26 USC \u00a7 32(a)(1)",
      "code": "\nmodule us.federal.irs.credits.eitc\nversion \"2024.1\"\njurisdiction us\n\nvariable eitc_phase_in {\n  entity TaxUnit\n  period Year\n  dtype Money\n  reference \"26 USC \u00a7 32(a)(1)\"\n\n  formula {\n    let earned = variable(earned_income)\n    let n_children = variable(n_qualifying_children)\n\n    # Credit percentage (phase-in rate) by number of children (2024)\n    let rate = match {\n      case n_children == 0 => 0.0765\n      case n_children == 1 => 0.34\n      case n_children == 2 => 0.40\n      else => 0.45\n    }\n\n    # Earned income amount (cap) by number of children (2024)\n    let cap = match {\n      case n_children == 0 => 7840\n      case n_children == 1 => 11750\n      else => 16510\n    }\n\n    # Credit = rate \u00d7 min(earned_income, cap)\n    return min(earned, cap) * rate\n  }\n}\n",
      "accuracy": 1.0,
      "iterations": 1,
      "success_factors": [
        "Used match expression for conditionals",
        "Used let bindings for clarity",
        "Used min/max for clamping",
        "Properly referenced input variables",
        "Correct on first attempt"
      ]
    },
    {
      "provision": "standard_deduction",
      "citation": "26 USC \u00a7 63(c)",
      "code": "module us.federal.irs.deductions.standard\nversion \"2024.1\"\njurisdiction us\n\nvariable standard_deduction {\n  entity TaxUnit\n  period Year\n  dtype Money\n  reference \"26 USC \u00a7 63(c)\"\n\n  formula {\n    let status = variable(filing_status)\n    \n    # Basic standard deduction amounts for 2024 by filing status\n    let basic_standard_deduction = match {\n      case status == \"SINGLE\" => 14600\n      case status == \"JOINT\" => 29200\n      case status == \"MARRIED_FILING_SEPARATELY\" => 14600\n      case status == \"HEAD_OF_HOUSEHOLD\" => 21900\n      else => 0\n    }\n    \n    return basic_standard_deduction\n  }\n}",
      "accuracy": 1.0,
      "iterations": 2,
      "success_factors": [
        "Used match expression for conditionals",
        "Used let bindings for clarity",
        "Properly referenced input variables"
      ]
    },
    {
      "provision": "salt_cap",
      "citation": "26 USC \u00a7 164(b)(6)",
      "code": "module us.federal.irs.deductions.salt\nversion \"2024.1\"\njurisdiction us\n\nvariable salt_deduction {\n  entity TaxUnit\n  period Year\n  dtype Money\n  reference \"26 USC \u00a7 164(b)(6)\"\n\n  formula {\n    let salt_paid = variable(state_and_local_taxes_paid)\n    let status = variable(filing_status)\n    \n    # Determine the cap based on filing status\n    # $5,000 for married filing separately, $10,000 for all others\n    let cap = match {\n      case status == \"MARRIED_FILING_SEPARATELY\" => 5000.00\n      case status == \"MFS\" => 5000.00\n      else => 10000.00\n    }\n    \n    # Deduction is the lesser of actual taxes paid or the cap\n    return min(salt_paid, cap)\n  }\n}",
      "accuracy": 1.0,
      "iterations": 5,
      "success_factors": [
        "Used match expression for conditionals",
        "Used let bindings for clarity",
        "Used min/max for clamping",
        "Properly referenced input variables"
      ]
    },
    {
      "provision": "eitc_phase_in",
      "citation": "26 USC \u00a7 32(a)(1)",
      "code": "\nmodule us.federal.irs.credits.eitc\nversion \"2024.1\"\njurisdiction us\n\nvariable eitc_phase_in {\n  entity TaxUnit\n  period Year\n  dtype Money\n  reference \"26 USC \u00a7 32(a)(1)\"\n\n  formula {\n    let earned = variable(earned_income)\n    let n_children = variable(n_children)\n\n    # Credit percentage (phase-in rate) by number of children (2024)\n    let rate = match {\n      case n_children == 0 => 0.0765\n      case n_children == 1 => 0.34\n      case n_children == 2 => 0.40\n      else => 0.45\n    }\n\n    # Earned income amount (cap) by number of children (2024)\n    let cap = match {\n      case n_children == 0 => 7840\n      case n_children == 1 => 11750\n      else => 16510\n    }\n\n    # Credit = rate \u00d7 min(earned_income, cap)\n    return min(earned, cap) * rate\n  }\n}\n",
      "accuracy": 1.0,
      "iterations": 1,
      "success_factors": [
        "Used match expression for conditionals",
        "Used let bindings for clarity",
        "Used min/max for clamping",
        "Properly referenced input variables",
        "Correct on first attempt"
      ]
    },
    {
      "provision": "standard_deduction",
      "citation": "26 USC \u00a7 63(c)",
      "code": "module us.federal.irs.deductions.standard\nversion \"2024.1\"\njurisdiction us\n\nvariable standard_deduction {\n  entity TaxUnit\n  period Year\n  dtype Money\n  reference \"26 USC \u00a7 63(c)\"\n\n  formula {\n    let status = variable(filing_status)\n    \n    # Basic standard deduction amounts for 2024 by filing status\n    let basic_standard_deduction = match {\n      case status == \"SINGLE\" => 14600\n      case status == \"JOINT\" => 29200\n      case status == \"MARRIED_FILING_SEPARATELY\" => 14600\n      case status == \"HEAD_OF_HOUSEHOLD\" => 21900\n      else => 0\n    }\n    \n    return basic_standard_deduction\n  }\n}",
      "accuracy": 1.0,
      "iterations": 1,
      "success_factors": [
        "Used match expression for conditionals",
        "Used let bindings for clarity",
        "Properly referenced input variables",
        "Correct on first attempt"
      ]
    },
    {
      "provision": "salt_cap",
      "citation": "26 USC \u00a7 164(b)(6)",
      "code": "\nmodule us.federal.irs.deductions.salt\nversion \"2024.1\"\njurisdiction us\n\nvariable salt_deduction {\n  entity TaxUnit\n  period Year\n  dtype Money\n  reference \"26 USC \u00a7 164(b)(6)\"\n\n  formula {\n    let salt_paid = variable(state_and_local_taxes_paid)\n    let status = variable(filing_status)\n    \n    # Determine the cap based on filing status\n    # $5,000 for married filing separately, $10,000 for all others\n    let cap = match {\n      case status == \"MARRIED_FILING_SEPARATELY\" => 5000.00\n      else => 10000.00\n    }\n    \n    # Deduction is the lesser of actual taxes paid or the cap\n    return min(salt_paid, cap)\n  }\n}\n",
      "accuracy": 1.0,
      "iterations": 1,
      "success_factors": [
        "Used match expression for conditionals",
        "Used let bindings for clarity",
        "Used min/max for clamping",
        "Properly referenced input variables",
        "Correct on first attempt"
      ]
    }
  ],
  "failure_patterns": [
    {
      "provision": "standard_deduction",
      "error_type": "value_mismatch",
      "description": "Output is $0 but expected $14600.00. Check if formula is correctly accessing inputs."
    },
    {
      "provision": "standard_deduction",
      "error_type": "value_mismatch",
      "description": "Output is $0 but expected $29200.00. Check if formula is correctly accessing inputs."
    },
    {
      "provision": "salt_cap",
      "error_type": "value_mismatch",
      "description": "Output $8000.00 differs from expected $5000.00 by $3000.00 (60.0%)."
    },
    {
      "provision": "salt_cap",
      "error_type": "value_mismatch",
      "description": "Output $8000.00 differs from expected $5000.00 by $3000.00 (60.0%)."
    },
    {
      "provision": "salt_cap",
      "error_type": "value_mismatch",
      "description": "Output is $0 but expected $8000.00. Check if formula is correctly accessing inputs."
    },
    {
      "provision": "salt_cap",
      "error_type": "value_mismatch",
      "description": "Output is $0 but expected $10000.00. Check if formula is correctly accessing inputs."
    },
    {
      "provision": "salt_cap",
      "error_type": "value_mismatch",
      "description": "Output $8000.00 differs from expected $5000.00 by $3000.00 (60.0%)."
    }
  ]
}